---
title: agave-validator
date: 2025-07-30 15:40:07
permalink: /pages/d4184f/
categories:
  - 区块链
  - Solana
tags:
  - 
author: 
  name: brook-w
  link: https://github.com/brook-w
---

## Agave Validator（solana） 文档

### 概述

​​agave-validator 2.2.16​

### 使用方法

```bash
agave-validator [选项] --ledger <目录> [子命令]
```

### 选项详解


#### 核心配置

| 选项 | 描述 | 默认值 |
| --- | --- | --- |
| `--ledger <目录>` | 账本存储目录 | `ledger` |
| `--identity <密钥对>` | 验证节点的身份密钥对 | *必填* |
| `--entrypoint <主机:端口>` | 加入集群的Gossip入口点 | *可多次指定* |
| `--vote-account <地址>` | 验证节点的投票账户公钥 | *若未指定，则禁用投票* |
| `--expected-genesis-hash <哈希>` | 要求创世块具有指定的哈希值 | *无* |
| `--expected-shred-version <版本>` | 要求shred版本为指定值 | *无* |
| `--wait-for-supermajority <槽位>` | 在处理完账本后，等到在Gossip中看到绝大多数权益才开始PoH | *无* |
| `--expected-bank-hash <哈希>` | 当使用`--wait-for-supermajority`时，要求该槽位的银行具有此哈希 | *无* |
| `--commission-bps <佣金点数>` | 验证器收取的小费佣金（以基点表示） | *无* |

#### 账户与存储

| 选项 | 描述 | 默认值 |
| --- | --- | --- |
| `--accounts <路径>` | 持久化账户位置（可指定多次） | `<LEDGER>/accounts` |
| `--account-shrink-path <路径>` | 账户压缩路径 | *无* |
| `--accounts-db-access-storages-method <方法>` | 访问账户存储的方法（可能值：mmap，file） | *无* |
| `--accounts-db-cache-limit-mb <MB>` | 账户数据写缓存的最大大小 | *无* |
| `--account-index <索引>` | 启用账户索引（可能值：program-id, spl-token-owner, spl-token-mint） | *无* |
| `--account-index-include-key <键>` | 只索引特定键（覆盖`--account-index-exclude-key`） | *无* |
| `--account-index-exclude-key <键>` | 排除特定键（可多次指定） | *无* |
| `--accounts-index-bins <BINS>` | 账户索引的分桶数量 | *无* |
| `--rocksdb-shred-compaction <模式>` | RocksDB压缩方式（可能值：level） | `level` |

#### 快照配置

| 选项 | 描述 | 默认值 |
| --- | --- | --- |
| `--snapshots <目录>` | 快照基础目录 | `--ledger值` |
| `--full-snapshot-archive-path <目录>` | 完整快照存档位置 | `--snapshots值` |
| `--incremental-snapshot-archive-path <目录>` | 增量快照存档位置 | `--snapshots值` |
| `--snapshot-interval-slots <数字>` | 生成快照的槽位间隔 | `100` |
| `--full-snapshot-interval-slots <数字>` | 生成完整快照的槽位间隔 | `25000` |
| `--no-snapshots` | 禁用所有快照生成 | `false` |
| `--no-incremental-snapshots` | 禁用增量快照 | `false` |
| `--snapshot-archive-format <格式>` | 快照存档格式（可能值：zstd, lz4） | `zstd` |
| `--snapshot-zstd-compression-level <级别>` | zstd压缩级别 | `1` |
| `--use-snapshot-archives-at-startup <模式>` | 启动时使用快照的行为（可能值：always, never, when-newest） | `when-newest` |

#### 网络配置

| 选项 | 描述 | 默认值 |
| --- | --- | --- |
| `--bind-address <主机>` | 绑定端口的IP地址 | `0.0.0.0` |
| `--dynamic-port-range <最小-最大>` | 动态分配端口范围 | `8000-10000` |
| `--gossip-host <主机>` | Gossip公告地址 | *根据--entrypoint确定* |
| `--gossip-port <端口>` | Gossip端口 | *无* |
| `--gossip-validator <身份>` | 指定可进行Gossip的验证节点 | 所有节点 |
| `--repair-validator <身份>` | 指定可请求修复的验证节点 | 所有节点 |
| `--known-validator <身份>` | 信任的快照发布验证节点 | *无* |
| `--only-known-rpc` | 仅使用已知验证节点的RPC | `false` |
| `--public-tpu-address <主机:端口>` | 公告的TPU地址 | *根据entrypoint确定* |
| `--public-tpu-forwards-address <主机:端口>` | 公告的TPU转发地址 | *根据entrypoint确定* |

#### RPC配置

| 选项 | 描述 | 默认值 |
| --- | --- | --- |
| `--rpc-port <端口>` | RPC服务端口 | *无* |
| `--rpc-bind-address <主机>` | RPC绑定IP | *根据--private-rpc确定* |
| `--private-rpc` | 不公开RPC端口 | `false` |
| `--public-rpc-address <主机:端口>` | 公开公告的RPC地址 | *使用--rpc设置* |
| `--full-rpc-api` | 启用完整链状态查询API | `false` |
| `--rpc-threads <数量>` | RPC服务线程数 | `32` |
| `--rpc-blocking-threads <数量>` | 阻塞型RPC请求线程数 | `8` |
| `--rpc-faucet-address <主机:端口>` | 启用空投API的水龙头地址 | *无* |
| `--rpc-max-request-body-size <字节>` | RPC最大请求体大小 | `51200` |
| `--enable-extended-tx-metadata-storage` | 存储CPI指令等扩展元数据 | `false` |

#### 性能优化

| 选项 | 描述 | 默认值 |
| --- | --- | --- |
| `--cuda` | 启用CUDA加速 | `false` |
| `--tpu-coalesce-ms <毫秒>` | TPU数据包合并等待时间 | *无* |
| `--tpu-enable-udp` | 启用UDP传输 | `false` |
| `--tpu-disable-quic` | 禁用QUIC传输 | `false` |
| `--block-production-method <方法>` | 区块生产方式（可能值：central-scheduler，central-scheduler-greedy） | `central-scheduler-greedy` |
| `--block-verification-method <方法>` | 区块验证方式（可能值：blockstore-processor，unified-scheduler） | `unified-scheduler` |
| `--unified-scheduler-handler-threads <数量>` | 统一调度器线程数 | `8` |

#### 调试与日志

| 选项 | 描述 | 默认值 |
| --- | --- | --- |
| `--log <文件>` | 日志输出位置 | *标准错误* |
| `--log-messages-bytes-limit <字节>` | 日志截断阈值 | *无* |
| `--debug-key <地址>` | 监控特定地址的交易 | *可多次指定* |
| `--dev-halt-at-slot <槽位>` | 在指定槽位停止 | *无* |
| `--disable-banking-trace` | 禁用银行跟踪 | `false` |
| `--enable-banking-trace <字节>` | 银行跟踪存储大小 | `15032385536` |

#### 安全与控制

| 选项 | 描述 | 默认值 |
| --- | --- | --- |
| `--no-voting` | 禁用投票 | `false` |
| `--require-tower` | 要求存在tower状态 | `false` |
| `--restricted-repair-only-mode` | 仅限修复模式（隐式--no-voting） | `false` |
| `--skip-startup-ledger-verification` | 跳过启动时账本验证 | `false` |
| `--wal-recovery-mode <模式>` | WAL恢复模式（可能值：tolerate\_corrupted\_tail\_records等） | *无* |

#### 插件系统

| 选项 | 描述 | 默认值 |
| --- | --- | --- |
| `--geyser-plugin-config <文件>` | Geyser插件配置文件 | *可多次指定* |
| `--geyser-plugin-always-enabled` | 总是启用Geyser接口 | `false` |

### 子命令详解

#### 验证器管理

| 子命令 | 描述 |
| --- | --- |
| `run` | 运行验证器（默认子命令） |
| `init` | 初始化账本目录并退出 |
| `monitor` | 监控验证器状态 |
| `exit` | 请求验证器退出 |
| `help` | 显示帮助信息 |

#### 配置管理

| 子命令 | 描述 |
| --- | --- |
| `set-identity` | 设置验证节点身份 |
| `set-public-address` | 设置Gossip公告地址 |
| `set-log-filter` | 调整日志过滤器 |
| `authorized-voter` | 管理授权投票者 |
| `staked-nodes-overrides` | 覆盖特定节点的质押设置 |

#### 网络操作

| 子命令 | 描述 |
| --- | --- |
| `repair-shred-from-peer` | 从特定节点请求修复 |
| `repair-whitelist` | 管理修复白名单 |
| `contact-info` | 显示联系信息 |

#### 插件管理

| 子命令 | 描述 |
| --- | --- |
| `plugin` | 管理Geyser插件 |

#### 维护操作

| 子命令 | 描述 |
| --- | --- |
| `wait-for-restart-window` | 寻找合适的重启时机 |

## Agave Validator（jito-solana） 文档

### 概述
​​agave-validator 2.3.6​
(来源: 4b702606; 特性: 3640012085, 客户端: JitoLabs)

### 使用方法
agave-validator [选项] --ledger <目录> [子命令]

### 选项详解

#### 核心配置

| 选项 | 描述 | 默认值 |
| --- | --- | --- |
| `--ledger <目录>` | 账本存储目录 | `ledger` |
| `--identity <密钥对>` | 验证节点的身份密钥对 | 必填 |
| `--entrypoint <主机:端口>` | 加入集群的Gossip入口点 | 可多次指定 |
| `--vote-account <地址>` | 验证节点的投票账户公钥 | 若未指定，则禁用投票 |
| `--expected-genesis-hash <哈希>` | 要求创世块具有指定的哈希值 | 无 |
| `--expected-shred-version <版本>` | 要求shred版本为指定值 | 无 |
| `--wait-for-supermajority <槽位>` | 在处理完账本后，等到在Gossip中看到绝大多数权益才开始PoH | 无 |
| `--expected-bank-hash <哈希>` | 当使用 `--wait-for-supermajority`时，要求该槽位的银行具有此哈希 | 无 |
| `--commission-bps <佣金点数>` | 验证器收取的小费佣金（以基点表示） | 无 |

#### 账户与存储

| 选项 | 描述 | 默认值 |
| --- | --- | --- |
| `--accounts <路径>` | 持久化账户位置（可指定多次） | `<LEDGER>/accounts` |
| `--account-shrink-path <路径>` | 账户压缩路径 | *无* |
| `--accounts-db-access-storages-method <方法>` | 访问账户存储的方法（可能值：mmap，file） | *无* |
| `--accounts-db-cache-limit-mb <MB>` | 账户数据写缓存的最大大小（超过时将更频繁刷新） | *无* |
| `--account-index <索引>` | 启用账户索引（可能值：program-id, spl-token-owner, spl-token-mint） | *无* |
| `--account-index-include-key <键>` | 只索引特定键（覆盖`--account-index-exclude-key`） | *无* |
| `--account-index-exclude-key <键>` | 排除特定键（可多次指定） | *无* |
| `--accounts-index-bins <BINS>` | 账户索引的分桶数量 | *无* |
| `--rocksdb-shred-compaction <模式>` | 控制RocksDB如何压缩shreds（可能值：level） | `level` |

#### 快照配置

| 选项 | 描述 | 默认值 |
| --- | --- | --- |
| `--snapshots <目录>` | 快照基础目录 | `--ledger值` |
| `--full-snapshot-archive-path <目录>` | 完整快照存档位置 | `--snapshots值` |
| `--incremental-snapshot-archive-path <目录>` | 增量快照存档位置 | `--snapshots值` |
| `--snapshot-interval-slots <数字>` | 生成快照的槽位间隔 | `100` |
| `--full-snapshot-interval-slots <数字>` | 生成完整快照的槽位间隔 | `50000` |
| `--no-snapshots` | 禁用所有快照生成 | `false` |
| `--no-incremental-snapshots` | 禁用增量快照 | `false` |
| `--snapshot-archive-format <格式>` | 快照存档格式（可能值：zstd, lz4） | `zstd` |
| `--snapshot-zstd-compression-level <级别>` | zstd压缩级别 | `1` |
| `--use-snapshot-archives-at-startup <模式>` | 启动时使用快照的行为（可能值：always, never, when-newest）启动时，应该何时提取快照存档，而不是使用磁盘上已有的状态？指定“always”将始终通过提取快照存档来启动，并忽略磁盘上已有的任何快照相关状态。请注意，从快照存档启动将产生与提取存档和重建本地状态相关的运行时开销。指定“never”将永远不会从快照存档启动，并且将仅使用磁盘上已有的快照相关状态。如果磁盘上没有已有状态，启动将失败。请注意，这将使用最新的可用状态，该状态可能比最新的快照存档更新。指定“when-newest”将使用磁盘上已有的快照相关状态，除非存在比它更新的快照存档。如果在节点停止时下载了新的快照存档，则可能会发生这种情况。 | `when-newest` |

#### 网络配置

| 选项 | 描述 | 默认值 |
| --- | --- | --- |
| `--bind-address <主机>` | 绑定端口的IP地址 | `0.0.0.0` |
| `--dynamic-port-range <最小-最大>` | 动态分配端口范围 | `8000-10000` |
| `--gossip-host <主机>` | Gossip公告地址 | *根据--entrypoint确定* |
| `--gossip-port <端口>` | Gossip端口 | *无* |
| `--gossip-validator <身份>` | 指定可进行Gossip的验证节点 | 所有节点 |
| `--repair-validator <身份>` | 指定可请求修复的验证节点 | 所有节点 |
| `--known-validator <身份>` | 信任的快照发布验证节点 | *无* |
| `--only-known-rpc` | 仅使用已知验证节点的RPC | `false` |
| `--block-engine-url <URL>` | Block Engine地址 | *禁用：设为空* |
| `--relayer-url <URL>` | Relayer地址 | *禁用：设为空* |
| `--tip-distribution-program-pubkey <公钥>` | 小费分发程序公钥 | *无* |
| `--tip-payment-program-pubkey <公钥>` | 小费支付程序公钥 | *无* |

#### RPC配置

| 选项 | 描述 | 默认值 |
| --- | --- | --- |
| `--rpc-port <端口>` | RPC服务端口 | *无* |
| `--rpc-bind-address <主机>` | RPC绑定IP | *根据--private-rpc确定* |
| `--private-rpc` | 不公开RPC端口 | `false` |
| `--public-rpc-address <主机:端口>` | 公开公告的RPC地址 | *使用--rpc设置* |
| `--full-rpc-api` | 启用完整链状态查询API | `false` |
| `--rpc-threads <数量>` | RPC服务线程数 | `32` |
| `--rpc-blocking-threads <数量>` | 阻塞型RPC请求线程数 | `8` |
| `--rpc-faucet-address <主机:端口>` | 启用空投API的水龙头地址 | *无* |
| `--rpc-max-request-body-size <字节>` | RPC最大请求体大小 | `51200` |
| `--enable-extended-tx-metadata-storage` | 存储CPI指令等扩展元数据 | `false` |


#### 性能优化

| 选项 | 描述 | 默认值 |
| --- | --- | --- |
| `--cuda` | 启用CUDA加速 | `false` |
| `--tpu-coalesce-ms <毫秒>` | TPU数据包合并等待时间 | *无* |
| `--tpu-enable-udp` | 启用UDP传输 | `false` |
| `--tpu-disable-quic` | 禁用QUIC传输 | `false` |
| `--block-production-method <方法>` | 区块生产方式（可能值：central-scheduler，central-scheduler-greedy） | `central-scheduler-greedy` |
| `--block-verification-method <方法>` | 区块验证方式（可能值：blockstore-processor，unified-scheduler） | `unified-scheduler` |
| `--unified-scheduler-handler-threads <数量>` | 统一调度器线程数 | `8` |
| `--preallocated-bundle-cost <CU>` | 为bundle预留的CU数量 | `3000000` |

#### 调试与日志

| 选项 | 描述 | 默认值 |
| --- | --- | --- |
| `--log <文件>` | 日志输出位置 | *标准错误* |
| `--log-messages-bytes-limit <字节>` | 日志截断阈值 | *无* |
| `--debug-key <地址>` | 监控特定地址的交易 | *可多次指定* |
| `--dev-halt-at-slot <槽位>` | 在指定槽位停止 | *无* |
| `--disable-banking-trace` | 禁用银行跟踪 | `false` |
| `--enable-banking-trace <字节>` | 银行跟踪存储大小 | `15032385536` |

#### 安全与控制

| 选项 | 描述 | 默认值 |
| --- | --- | --- |
| `--no-voting` | 禁用投票 | `false` |
| `--require-tower` | 要求存在tower状态 | `false` |
| `--restricted-repair-only-mode` | 仅限修复模式（隐式--no-voting） | `false` |
| `--trust-block-engine-packets` | 信任Block Engine数据包（不推荐） | `false` |
| `--trust-relayer-packets` | 信任Relayer数据包（不推荐） | `false` |

#### 插件系统

| 选项 | 描述 | 默认值 |
| --- | --- | --- |
| `--geyser-plugin-config <文件>` | Geyser插件配置文件 | *可多次指定* |
| `--geyser-plugin-always-enabled` | 总是启用Geyser接口 | `false` |
| `--runtime-plugin-config <文件>` | 运行时插件配置文件 | *可多次指定* |

### 子命令详解

#### 验证器管理

| 子命令 | 描述 |
| --- | --- |
| `run` | 运行验证器（默认子命令） |
| `init` | 初始化账本目录并退出 |
| `monitor` | 监控验证器状态 |
| `exit` | 请求验证器退出 |
| `help` | 显示帮助信息 |

#### 配置管理

| 子命令 | 描述 |
| --- | --- |
| `set-identity` | 设置验证节点身份 |
| `set-public-address` | 设置Gossip公告地址 |
| `set-log-filter` | 调整日志过滤器 |
| `authorized-voter` | 管理授权投票者 |
| `staked-nodes-overrides` | 覆盖特定节点的质押设置 |

#### 网络操作

| 子命令 | 描述 |
| --- | --- |
| `repair-shred-from-peer` | 从特定节点请求修复 |
| `repair-whitelist` | 管理修复白名单 |
| `set-block-engine-config` | 配置Block Engine连接 |
| `set-relayer-config` | 配置Relayer连接 |
| `set-shred-receiver-address` | 设置Shred接收地址 |
| `set-shred-retransmit-receiver-address` | 设置Shred重传地址 |
| `contact-info` | 显示联系信息 |

#### 插件管理

| 子命令 | 描述 |
| --- | --- |
| `plugin` | 管理Geyser插件 |
| `runtime-plugin` | 管理运行时插件 |

#### 维护操作

| 子命令 | 描述 |
| --- | --- |
| `wait-for-restart-window` | 寻找合适的重启时机 |

### 默认行为

- 未指定子命令时自动执行run
- 必须提供--ledger目录
- 除非使用--no-voting或未设置--vote-account，否则需要身份密钥进行投票
- 默认生成快照（间隔100个槽位）
- 默认启用银行性能跟踪
- RPC API默认禁用完整功能（需--full-rpc-api）


## 版本差异 (solana vs jito-solana)

### 1. 增加的子命令

- set-relayer-config
- set-block-engine-config
- set-shred-receiver-address
- set-shred-retransmit-receiver-address
- runtime-plugin

### 2. ​​选项差异​​

- 增加 --block-engine-url 和 --relayer-url 选项
- --full-snapshot-interval-slots 默认值从50000变为25000
- 增加 --preallocated-bundle-cost 选项
- 增加 --tip-distribution-program-pubkey 和 --tip-payment-program-pubkey

### 3. 功能差异
- 缺少与Relayer和Block Engine集成的相关功能
- 缺少小费分发程序相关配置
- 缺少运行时插件支持